datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Users {
  id Int @default(autoincrement()) @id
  firstName String
  lastName String
  email String @unique
  password String
  userType UserType
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  project Projects[]
  bid Bids[]
  Proposal Proposals[]
  @@index([email])
}

model Projects {
  id Int @default(autoincrement()) @id
  title String @db.VarChar(250)
  description String
  category    String // Backend Development | Frontend
  skills      Json  // ["NestJS", "TypeScript", "PostgreSQL", "Stripe"],
  budget Decimal @db.Decimal(10, 2)
  deadline DateTime?
  status ProjectStatus @default(open)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
  user Users @relation(fields: [clientId], references: [id])
  clientId Int 
  proposal Proposals[]
  bid Bids[]
  @@index([status])
}

model Bids {
  id Int @default(autoincrement()) @id
  project Projects @relation(fields: [projectId], references: [id])
  freelancer Users @relation(fields: [freelancerId], references: [id]) 
  proposal Proposals?
  projectId Int
  freelancerId Int
  amount Decimal @db.Decimal(10, 2)
  estimatedWork String @db.VarChar(100)
  coverLetter String
  aiAsuggestions String?
  experience String
  cv String
  status BidStatus @default(pending)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([freelancerId, projectId])
}


model Proposals {
  id Int @default(autoincrement()) @id
  user Users @relation(fields: [freelancerId], references: [id])
  freelancerId Int
  project Projects @relation(fields: [projectId], references: [id])
  projectId Int
  bid Bids @relation(fields: [bidId], references: [id])
  bidId Int
  status ProposalStatus @default(pending)
  proposalUrl String
  additionalDerails String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([bidId])
} 

enum ProjectStatus {
  open
  in_progress
  completed
  closed
}

enum UserType {
  client
  freelancer
}

enum ProposalStatus {
  pending 
  accepted 
  rejected 
}

enum BidStatus {
  pending
  accepted
  rejected
}